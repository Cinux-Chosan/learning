# 前端零散知识点

## HTTPS

首先需要明确：

- `对称加密`：同一个秘钥，加密解密都用它，加解密执行效率较高
- `非对称加密`：分为`公钥`（可以给任何人）和`私钥`（只能自己持有），`公钥`加密只能`私钥`解密，`私钥`加密需要`公钥`解密，加解密执行效率较低

客户端首先从服务器获取证书，由于证书是 CA 机构（证书认证机构）签发 _（其中包含申请者的公钥，组织信息，域名信息等 ）_ ，因此可以使用浏览器或操作系统内集成的常见 CA 机构的公钥进行验证，验证通过之后则获得证书公钥 _（引入 CA 验证的证书可以防止公钥被中间人拦截，因为浏览器只知道自己从服务器拿到了公钥，并不知道在获取的过程中公钥是否已经被拦截和篡改，如果是已经篡改过的公钥，那将会导致浏览器用这个公钥一直错下去，它可能一直以为自己拿到的就是正确的公钥）_。

由于非对称加密性能较差，对称加密解密更快，因此 https 采用二者结合的方式。客户端获取到公钥之后，会随机生成一个**对称加密**的秘钥，然后用服务器给的公钥进行加密，再将加密结果发送给服务器，服务器收到之后使用私钥进行解密从而获得其中的**对称加密**的秘钥，然后使用对称加密来进行通信，从而提升效率！

其中核心部分就是围绕 **如何安全交换对称秘钥**

参考资料：

- https://juejin.cn/post/6906443847811907597
- https://juejin.cn/post/6844904089495535624
- https://juejin.cn/post/6845166890675863559

## 三次握手四次挥手

握手和挥手一般双方（客户端和服务器端）都会生成自己的序列号用于标记请求序列（用于重传或接收，TCP 可靠连接就是靠序列号来达成的），通常通过 `seq` 字段发送给对方，而另一方一般会使用 `ack` 来响应对方，`ack` 的值是 `seq` 的值加 `1`，表示当前序列已经接收到，请求发送下一个序列的数据，即 `seq + 1` 的数据（`ack` 是累计的，即 `ack` 之前但不包括 `ack` 是**已经确认被接收到了**的）。

### 三次握手

- 流程：

  - 客户端发起 `SYN` 表示自己希望建立连接（HTTP 规定 SYN 不能发送数据，因此前两次握手无法发送数据，第三次可以）
  - 服务端收到，并响应 `SYN` 和 `ACK`
  - 客户端收到服务器响应，发送 `ACK`，当服务端收到 `ACK` 则成功建立连接。

- 为什么要 3 次握手：

  - 避免因网络拥堵引起的请求后到达导致服务器误以为重新建立连接的情况。
  - 需要 3 次握手来确定双方的初始序列号（参考 [知乎这里的回答](https://www.zhihu.com/question/24853633/answer/573627478)）
    1. 客户端发送 `seq` 给服务端
    2. 服务端响应给客户端 `ack`
    3. 服务端发送给客户端自己的 `seq`（由于和上一步都是服务端发送给客户端，因此合并发送 `ack` 和服务器自己的 `seq`，但第一步和第四部无法合并，因此至少需要 3 次握手）
    4. 客户端响应服务端 `ack`

### 四次挥手

- 流程：

  - 客户端发起 `FIN` 希望断开 `客户端 -> 服务端` 方向的连接
  - 服务端收到后响应 `ACK` 表示可以断开，客户端进入 FIN-WAIT-2 状态等待服务端发出断开请求
  - 服务端发出 `FIN` 和 `ACK` 表示可以断开 `服务器 -> 客户端` 的连接
  - 客户端响应 `ACK` 表示可以断开，然后整个断开过程完成

- 为什么要四次挥手
  - 因为 TCP 是`双向`的，每两次挥手用于断开其中一个方向的数据传输。
  - 前两次挥手用于关闭 `客户端 -> 服务器` 方向的数据发送，断开之后客户端不可再向服务器发送数据，但是 `服务器 -> 客户端` 还未断开，因此服务器还可以向客户端发送数据，因此还需要再断开 `服务器 -> 客户端` 方向的数据发送。
  - 中间的两次是无法合并的，因为第二次是服务端回应 `客户端 -> 服务端` 方向的连接可以断开，而第三次是服务端通知客户端断开连接，第二次只是表明从客户端到服务端的数据不会在发送了，而可能此时服务端还在向客户端发送数据或者稍后还会发送数据，因此暂时还不可以发送第三次挥手

参考资料：

- https://www.zhihu.com/question/24853633/answer/573627478
- https://segmentfault.com/a/1190000021494676?utm_source=sf-similar-article
- https://zhuanlan.zhihu.com/p/103000747